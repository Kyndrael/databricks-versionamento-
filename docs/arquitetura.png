
# üß≠ Arquitetura ‚Äî Databricks + Azure DevOps

Este documento descreve a arquitetura de refer√™ncia para versionamento e organiza√ß√£o de notebooks no **Azure Databricks** com **Azure DevOps** (Repos + Pipelines), contemplando CI/CD, seguran√ßa e boas pr√°ticas.

---

## üîé Vis√£o Geral

- **Versionamento**: notebooks sob Git (Azure Repos) com PRs, branch policies e revis√£o.
- **Execu√ß√£o**: Jobs/Clusters no Databricks (interativo e agendado).
- **CI/CD**: Azure Pipelines valida notebooks (lint/execu√ß√£o r√°pida) e faz deploy para o Workspace.
- **Dados**: leitura/escrita em **ADLS Gen2**; cat√°logo e governan√ßa com **Unity Catalog**.
- **Seguran√ßa**: Service Principal/Managed Identity, segredos no **Key Vault**, RBAC/ACLs e **SCIM** para identidade.

---

## üß© Componentes
- **Azure DevOps Repos** ‚Äî controle de vers√£o dos notebooks e scripts.
- **Azure DevOps Pipelines** ‚Äî esteiras de CI (valida√ß√£o) e CD (deploy).
- **Azure Databricks Workspace** ‚Äî ambiente de notebooks, clusters, jobs.
- **Unity Catalog / Metastore** ‚Äî governan√ßa, permiss√µes, lineage.
- **Azure Data Lake Storage Gen2 (ADLS)** ‚Äî dados e camadas (bronze/silver/gold).
- **Azure Key Vault** ‚Äî armazenamento de segredos/credenciais.
- **Fontes de Dados** ‚Äî SQL/Parquet/CSV/Delta (on-prem ou cloud).

---

## üó∫Ô∏è Diagrama ‚Äî Vis√£o L√≥gica

```mermaid
flowchart LR
    Dev[Desenvolvedor(a)] -->|Commit/PR| Repos[Azure DevOps Repos]
    Repos -->|Trigger| Pipelines[Azure DevOps Pipelines]

    Pipelines -->|Auth SP/Mgd Identity| DBCli[Databricks API/CLI]
    DBCli --> WS[Azure Databricks Workspace]
    WS --> Jobs[Jobs & Clusters]
    WS --> ReposDB[Databricks Repos]

    subgraph Dados & Governan√ßa
      UC[Unity Catalog / Metastore]
      ADLS[(ADLS Gen2<br/>bronze ‚Ä¢ silver ‚Ä¢ gold)]
      DBFS[/DBFS/]
      UC --- ADLS
      WS --- UC
      WS --- DBFS
    end

    extSrc[(Fontes SQL/CSV/Parquet)] --> WS
    Jobs --> ADLS
    WS -->|Visualiza√ß√µes| Viz[Dashboards/Gr√°ficos]

    KV[Azure Key Vault] -. segredos/creds .- Pipelines
    KV -. segredos/creds .- WS
